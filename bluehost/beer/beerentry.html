<HTML>
	<HEAD>
        <SCRIPT>var isomorphicDir="../sc/SmartClient_v120p_2018-04-07_LGPL/smartclientRuntime/isomorphic/";</SCRIPT>
        <SCRIPT SRC=../sc/SmartClient_v120p_2018-04-07_LGPL/smartclientRuntime/isomorphic/system/modules/ISC_Core.js></SCRIPT>
        <SCRIPT SRC=../sc/SmartClient_v120p_2018-04-07_LGPL/smartclientRuntime/isomorphic/system/modules/ISC_Foundation.js></SCRIPT>
        <SCRIPT SRC=../sc/SmartClient_v120p_2018-04-07_LGPL/smartclientRuntime/isomorphic/system/modules/ISC_Containers.js></SCRIPT>
        <SCRIPT SRC=../sc/SmartClient_v120p_2018-04-07_LGPL/smartclientRuntime/isomorphic/system/modules/ISC_Grids.js></SCRIPT>
        <SCRIPT SRC=../sc/SmartClient_v120p_2018-04-07_LGPL/smartclientRuntime/isomorphic/system/modules/ISC_Forms.js></SCRIPT>
        <SCRIPT SRC=../sc/SmartClient_v120p_2018-04-07_LGPL/smartclientRuntime/isomorphic/system/modules/ISC_DataBinding.js></SCRIPT>
        <SCRIPT SRC=../sc/SmartClient_v120p_2018-04-07_LGPL/smartclientRuntime/isomorphic/skins/SmartClient/load_skin.js></SCRIPT>
        <script src=../sc/SmartClient_v120p_2018-04-07_LGPL/smartclientRuntime/isomorphic/EnterpriseBlue/fleet/load_skin.js></script>
        <SCRIPT SRC=../shared/ClassDefaults.js></SCRIPT>
	</HEAD>
	<BODY>
<SCRIPT>
isc.BeerEntryVL = isc.VLayout.create({
    canDragResize: true,
    name: "BeerEntryVL",
    parent: this,
    shadowOffset: 3,
    shadowSoftness: 7,
    showMaximizeButton: true,
    title: "Beer Entry",
	initWidget: function(initData){
		this.Super("initWidget", arguments);
        this.EventBeerDS = isc.myDataSource.create({
            // cacheAllData: true,
            // cacheMaxAge: 86400,
            // dataFormat: "json",
            // dataProtocol: "postParams",
            dataURL: "BeerEntry.php",
            // parent: this,
            fields:[
                {name: "eventBeerID", primaryKey: true, detail: true, type: "sequence"},
                {name: "eventID", title: "Event", width: 100, type: "integer", title: "Event"},
                {name: "clubID", title: "Club", width: 100, title: "Club"},
                {name: "bjcp2015styleID_fk", title: "BJCP Style", width: 180, type: "integer"},
                {name: "beerStyle", title: "Old Beer Style", width: 50, validators: [{type: "lengthRange", max: 100}]},
                {name: "beerName", width: 250, validators: [{type: "lengthRange", max: 100}]},
                {name: "brewerName", width: 200, validators: [{type: "lengthRange", max: 100}]},
                {name: "abv", title: "ABV", width: 80, type: "float"},
                {name: "lastChangeDate", width: 100, detail: true}
            ]
            // transformRequest: function(dsRequest){
            //     var superClassArguments = this.Super("transformRequest", dsRequest);
            //     var userID = 0;
            //     if(typeof saveUserID !== 'undefined'){
            //         userID = saveUserID;
            //     }
            //     var newProperties = {operationType: dsRequest.operationType, userID: userID};
            //     return isc.addProperties({}, superClassArguments, newProperties);
            // }
        });
// {name: "eventID", width: 100, type: "integer", title: "Event", optionDataSource: isc.Shared.eventTypesDS, displayField: "eventType", valueField: "eventTypeID", optionCriteria: {active: "Y"}},
// {name: "clubID", width: 100, title: "Club", optionDataSource: isc.Shared.brewClubsDS, optionCriteria: {active: "Y"}, displayField: "clubAbbr", valueField: "clubID", pickListWidth: 300, pickListProperties: {showFilterEditor: true}, pickListFields: [{name: "clubAbbr", width: "70"},{name: "clubName", width: "*"}]},
// {name: "bjcp2015styleID_fk", title: "BJCP Style", width: 180, type: "integer", optionDataSource: isc.Shared.bjcp2015_styleDS, displayField: "bjcpStyle", valueField: "bjcp2015styleID", pickListWidth: 300, pickListProperties: {showFilterEditor: true}, pickListFields: [{name: "bjcpCode", width: "50"}, {name: "bjcpStyle", width: "*"}]},
        this.EventBeerLG = isc.myListGrid.create({
            autoFetchData: true,
            canEdit: false,
            dataSource: this.EventBeerDS,
            height: 300,
            name: "Club Beers",
            parent: this,
            sortField: 1
        });
        this.EventBeerBT = isc.myIButton.create({
            parent: this,
            title: "Add",
            click: function(){
                this.parent.submitData();
            }
        });
        this.EventBeerDF = isc.myDynamicForm.create({
            autoFetchData: false,
            canDragResize: true,
            // dataSource: this.EventBeerDS,
            // height: "100%",
            numCols: 3,
            parent: this,
            width: "100%",
            fields:[
                {name: "eventBeerID", primaryKey: true, detail: true, type: "sequence"},
                {name: "eventID", title: "Event", width: 100, type: "integer", title: "Event"},
                {name: "clubID", title: "Club", width: 100, title: "Club"},
                {name: "bjcp2015styleID_fk", title: "BJCP Style", width: 180, type: "integer"},
                {name: "beerStyle", title: "Old Beer Style", width: 50, validators: [{type: "lengthRange", max: 100}]},
                {name: "beerName", width: 250, validators: [{type: "lengthRange", max: 100}]},
                {name: "brewerName", width: 200, validators: [{type: "lengthRange", max: 100}]},
                {name: "abv", title: "ABV", width: 80, type: "float"},
                {name: "lastChangeDate", width: 100, detail: true}
            ]
        });
        this.EventBeerLB = isc.myLabel.create({
            align: "left",
            baseStyle: "headerItem",
            contents: "<bold><h3>Add Beer for NCHI</h3></bold>",
            height: 1,
            margin: 4
        }),
        this.EventBeerWD = isc.myWindow.create({
            autoCenter: true,
            height: "50%",
            parent: this,
            title: "Beer Entry",
            width: "50%",
            members: [this.EventBeerLB, this.EventBeerDF, this.EventBeerBT, this.EventBeerLG]
        })
        this.EventBeerWD.addProperties();
        this.EventBeerLG.fetchData({clubID: 1});
    },
    submitData: function(){
        console.log("submitData:");
        var formData = this.EventBeerDF.getValues();
        var newData = isc.addProperties({}, formData, {operationType: "add"});
        console.log(newData);
        // myForm.setValues(data);
        this.EventBeerDS.addData(formData, function(dsResponse, data, dsRequest){
            console.log(dsRequest);
            console.log(data);
            console.log(dsResponse);
            this.EventBeerLG.fetchData({clubID: 1});
            this.EventBeerDF.clearValues();
        });
        // var selectedData = this.AddEventLG.getSelectedRecords();
        // var newData;
        // var loop = selectedData.length;
        // var zero = 0;
        // for (i = zero; i < loop; i++) {
        //     // newData = {
        //     //     dateDetail: formData["dateDetail"],
        //     //     dateTypeID_fk: formData["dateTypeID_fk"],
        //     //     memberDate: formData["memberDate"],
        //     // };
        //     this.EventBeerDS.addData(formData);
        // }
    }
});
</SCRIPT>
</BODY>
</HTML>
